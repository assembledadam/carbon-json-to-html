<?php
/**
 * Carbon JSON to HTML converter
 *
 * @author  Adam McCann (@AssembledAdam)
 * @license MIT (see LICENSE file)
 */
namespace CarbonJsonToHtmlTests;

use \Candybanana\CarbonJsonToHtml\Converter;
use \Candybanana\CarbonJsonToHtml\Components\Paragraph;

class ConverterTest extends \PHPUnit_Framework_Testcase
{
    public function testConvertsJsonToHtml()
    {
        $converter = new Converter();

        // add custom attributes to formatting component
        $paragraph = new Paragraph([
            'a' => function ($attrs, $text) {
                return [
                    'rel' => 'nofollow'
                ];
            }
        ]);

        $converter->addComponent('Paragraph', $paragraph);

        $input = '{"sections": [{"name": "zrxofl46", "component": "Section", "components": [{"name": "l604jt7a", "type": "article__section__aligned", "tagName": "div", "component": "Layout", "components": [{"src": "https://www.googleapis.com/download/storage/v1/b/carbon-demo-user-uploads/o/selfie-1462838229973?generation=1462838231280000&alt=media", "name": "vmilxr5x", "width": "300px", "height": "171.375px", "caption": "Uploaded to GCS Bucket, this is temp for demo sake and uploaded images will be deleted regularly.", "component": "Figure"}]}, {"name": "6w8bxiqu", "type": "article__section--gutter", "tagName": "div", "component": "Layout", "components": [{"name": "6akxzwwx", "text": "The blurring between genres is embodied by your character, a sleeper agent in The Division – a clandestine task force to restore order when all else fails – activated after a virus is released in New York, decimating the city and surrounding area. At character creation you go \'Ah yes, an RPG,\' but then realise your choice is from a stock set of approximately 16 faces, all of which are a bit amorphous, as if they were molded from brie and then left in the sun.", "component": "Paragraph", "paragraphType": "h3", "placeholderText": null}, {"name": "t3mtl2jf", "text": "In game your agent is a stoic soldier, trained to dispassionately kill thugs who were once their fellow citizens and never once speaking, so you go \'Ah yes, a shooter.\' Except you can also customise their entire outfit, separate to their combat gear, with clothes as described by someone\'s dad: \'trendy military jacket\', \'cool waterproof boots\', so you go \'Ah yes, an RPG,\' again, before you get to grips with the classless class system, which is decidedly not like an RPG.", "component": "Paragraph", "paragraphType": "p", "placeholderText": null}, {"name": "3fsp4dab", "text": "Rather than locking your character into one class, you can change your role on the fly by using the interaction between your gear and abilities. The combat gear has different scores which directly change what your character is best at, which, despite being a complex system, works really well in game. Skills (the abilities you can actively trigger in combat) are also well designed to balance with different roles, and, as is the case with the most fun bits of any game, are ridiculous. Aside from area of effect healing and portable cover, you can get yourself a riot shield that heals you as it gets shot, or a sticky bomb that fires long distances and attaches to/explodes that bastard sniper. Having different skills mapped completely changes how you play.", "formats": [{"to": 486, "from": 476, "type": "em", "attrs": {}}, {"to": 11, "from": 8, "type": "a", "attrs": {"href": "http://www.google.com"}}], "component": "Paragraph", "paragraphType": "p", "placeholderText": null}, {"name": "cto66fw5", "text": "This has all been done in the name of good multiplayer, and it\'s worked: the multiplayer in The Division is probably the most fun multiplayer has been for literally years. The shining light of the whole game is the PvP in the Dark Zone.", "component": "Paragraph", "paragraphType": "p", "placeholderText": null}, {"name": "k4dy2m0u", "text": "It\'s in the Dark Zone that you run into other players, and all bets are off. The NPC enemies are tougher too, and you\'ll often find yourself teaming up with these unknown agents to take them down for the higher level loot. Dark Zone loot is more valuable than loot from outside, and at any point those dudes you were working with a second ago could suddenly decide maybe they want what you\'ve got.", "formats": [{"to": 375, "from": 371, "type": "em", "attrs": {}}], "component": "Paragraph", "paragraphType": "p", "placeholderText": null}, {"name": "2jkhei7i", "text": "You\'ll often find groups of hostile players camping around the extraction points. You start to eye up other players suspiciously by default; you can even be fired upon accidentally if a twitchy agent mistakes you for an NPC, and then everything has to be diffused with a hand wave or salute emote. There\'s proximity voice chat if you all have your mics turned on, leading to heavily accented and tentative hellos, congratulations on stylish kills, and agreements to cover one another on the extraction. It is, genuinely, fantastic, and the unpredictable nature of the Dark Zone is what makes it so.", "component": "Paragraph", "paragraphType": "p", "placeholderText": null}, {"name": "wd8hr16x", "text": "In comparison the PvE missions can be fatiguing, boiling down to shooting increasingly difficult waves of enemies, no matter if it\'s dressed up as a hostage situation or a main story mission. The emphasis is on cover shooting, and while the cover system is great the actual shooting still feels like firing nerf darts at mannequins.", "component": "Paragraph", "paragraphType": "p", "placeholderText": null}, {"name": "dt0mo7ze", "text": "", "component": "Paragraph", "paragraphType": "p", "placeholderText": null}, {"name": "keoecnmb", "text": "", "component": "Paragraph", "paragraphType": "p", "placeholderText": null}]}]}]}';

        $output = $converter->convert($input);

        $expected = "<section><div class=\"article__section__aligned\"><figure><div class=\"image-container\"><img src=\"https://www.googleapis.com/download/storage/v1/b/carbon-demo-user-uploads/o/selfie-1462838229973?generation=1462838231280000&amp;alt=media\"></div><figcaption>Uploaded to GCS Bucket, this is temp for demo sake and uploaded images will be deleted regularly.</figcaption></figure></div><div class=\"article__section--gutter\"><h3>The blurring between genres is embodied by your character, a sleeper agent in The Division &ndash; a clandestine task force to restore order when all else fails &ndash; activated after a virus is released in New York, decimating the city and surrounding area. At character creation you go 'Ah yes, an RPG,' but then realise your choice is from a stock set of approximately 16 faces, all of which are a bit amorphous, as if they were molded from brie and then left in the sun.</h3><p>In game your agent is a stoic soldier, trained to dispassionately kill thugs who were once their fellow citizens and never once speaking, so you go 'Ah yes, a shooter.' Except you can also customise their entire outfit, separate to their combat gear, with clothes as described by someone's dad: 'trendy military jacket', 'cool waterproof boots', so you go 'Ah yes, an RPG,' again, before you get to grips with the classless class system, which is decidedly not like an RPG.</p><p><p>Rather than locki<a href=\"http://www.google.com\" rel=\"nofollow\">ng </a>your character into one class, you can change your role on the fly by using the interaction between your gear and abilities. The combat gear has different scores which directly change what your character is best at, which, despite being a complex system, works really well in game. Skills (the abilities you can actively trigger in combat) are also well designed to balance with different roles, and, as is the case with the most fun bits of any game, are <em>ridiculous</em>. Aside from area of effect healing and portable cover, you can get yourself a riot shield that heals you as it gets shot, or a sticky bomb that fires long distances and attaches to/explodes that bastard sniper. Having different skills mapped completely changes how you play.</p></p><p>This has all been done in the name of good multiplayer, and it's worked: the multiplayer in The Division is probably the most fun multiplayer has been for literally years. The shining light of the whole game is the PvP in the Dark Zone.</p><p><p>It's in the Dark Zone that you run into other players, and all bets are off. The NPC enemies are tougher too, and you'll often find yourself teaming up with these unknown agents to take them down for the higher level loot. Dark Zone loot is more valuable than loot from outside, and at any point those dudes you were working with a second ago could suddenly decide maybe <em>they</em> want what you've got.</p></p><p>You'll often find groups of hostile players camping around the extraction points. You start to eye up other players suspiciously by default; you can even be fired upon accidentally if a twitchy agent mistakes you for an NPC, and then everything has to be diffused with a hand wave or salute emote. There's proximity voice chat if you all have your mics turned on, leading to heavily accented and tentative hellos, congratulations on stylish kills, and agreements to cover one another on the extraction. It is, genuinely, fantastic, and the unpredictable nature of the Dark Zone is what makes it so.</p><p>In comparison the PvE missions can be fatiguing, boiling down to shooting increasingly difficult waves of enemies, no matter if it's dressed up as a hostage situation or a main story mission. The emphasis is on cover shooting, and while the cover system is great the actual shooting still feels like firing nerf darts at mannequins.</p><p></p><p></p></div></section>";

        $this->assertSame($expected, $output);
    }
}
